<turbo-frame id="training-records-form">
	{% if selectedOperators is defined and selectedOperators is not empty %}


		<form class="d-flex flex-column justify-content-evenly" id="trainingRecords-form" method="post" action="{{path('app_training_record_form', {'uploadId': upload.id, 'teamId': team.id, 'uapId': uap.id})}}">
			<p style="flex:1;" class=" mx-2 card text-center">
				Liste des Opérateurs de l'équipe
				{{team.name|upper}}
				pour l'
				{{uap.name|upper ~ '.'}}
			</p>

			<strong>
				{% if operatorsByTrainer is defined and operatorsByTrainer is not empty %}
					{% for trainerName, operators in operatorsByTrainer %}

						<p class="mx-2 card text-center" style="flex:1;">
							Opérateurs formés par
							{{ trainerName != null ? trainerName|upper|split('.')|last ~ ' ' ~ trainerName|capitalize|split('.')|first 
							: 'un formateur inconnu' }}
						</p>

						{% for operator in operators  %}
							{% set trainingRecord = operator.trainingRecords|filter(record => record.upload.id == upload.id) | first %}
							{% include 'services/operators/training_component/_listOperatorPart_operator_listing_form.html.twig' with {'operator': operator, 'trainingRecord': trainingRecord} %}
						{% endfor %}
					{% endfor %}
				{% endif %}

				{% if inTrainingOperatorsByTrainer is defined and inTrainingOperatorsByTrainer is not empty %}
					{% for trainerName, operators in inTrainingOperatorsByTrainer %}

						<p style="flex:1;" class=" mx-2 card text-center">
							Opérateurs à requalifier. Anciennement formé par
							{{ trainerName != null ? trainerName|upper|split('.')|last ~ ' ' ~ trainerName|capitalize|split('.')|first ~ '.'}}
						</p>
						{% for operator in operators %}
							{% set trainingRecord = operator.trainingRecords|filter(record => record.upload.id == upload.id) | first %}

							{% include 'services/operators/training_component/_listOperatorPart_operator_listing_form.html.twig' with {'operator': operator, 'trainingRecord': trainingRecord} %}

						{% endfor %}


					{% endfor %}
				{% endif %}
				{% if untrainedOperators is defined and untrainedOperators is not empty %}
					<p style="flex:1;" class=" mx-2 card text-center">
						Opérateurs jamais formés au process.
					</p>
					{% for operator in untrainedOperators %}
						{% set trainingRecord = operator.trainingRecords|filter(record => record.upload.id == upload.id) | first %}
						{% include 'services/operators/training_component/_listOperatorPart_operator_listing_form.html.twig' with {'operator': operator, 'trainingRecord': trainingRecord} %}


					{% endfor %}
				{% endif %}

			</strong>
			<div id="trainingValidationSubmitContainer" name="trainingValidationSubmitContainer"></div>
		</form>
	{% else %}
		<p style="flex:1;" class=" mx-2 card text-center">
			Liste tout UAP et équipe confondue. Pour modifier ces informations, veuillez sélectionner une équipe et une UAP.
		</p>
		{% if trainingRecords is defined and trainingRecords is not empty %}
			<p style="flex:1;" class=" mx-2 card text-center">
				Opérateurs formés.
			</p>
			{% for record in trainingRecords %}
				{% if record.trained is same as(true) %}

					{% include 'services/operators/training_component/_listOperatorPart_operator_listing.html.twig' with {'operator': record.operator, 'trainingRecord': record} %}
				{% endif %}

			{% endfor %}
			<p style="flex:1;" class=" mx-2 card text-center">
				Opérateurs à requalifier
			</p>
			{% for record in trainingRecords %}
				{% if record.trained is same as(false) %}
					{% include 'services/operators/training_component/_listOperatorPart_operator_listing.html.twig' with {'operator': record.operator, 'trainingRecord': record} %}
				{% endif %}
			{% endfor %}
			<p style="flex:1;" class=" mx-2 card text-center">
				Opérateurs Non-formés.
			</p>
			{% for operator in operators %}
				{% set trainingRecord = operator.trainingRecords|filter(record => record.upload.id == upload.id) | first %}
				{% if trainingRecord == null %}

					{% include 'services/operators/training_component/_listOperatorPart_operator_listing.html.twig' with {'operator': operator, 'trainingRecord': trainingRecord} %}

				{% endif %}
			{% endfor %}
		{% else %}
			<p style="flex:1;" class=" mx-2 card">
				Aucune liste correspondant aux critéres n'a été trouvé, sélectionnez d'autres critéres ou ajouté des opérateurs à la liste.
			</p>
			{% for operator in operators %}
				{% set trainingRecord = operator.trainingRecords|filter(record => record.upload.id == upload.id) | first %}
				{% include 'services/operators/training_component/_listOperatorPart_operator_listing.html.twig' with {'operator': operator, 'trainingRecord': trainingRecord} %}
			{% endfor %}
		{% endif %}
	{% endif %}
</turbo-frame>
