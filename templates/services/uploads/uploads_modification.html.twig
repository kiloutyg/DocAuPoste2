{% extends 'base.html.twig' %}
{% block title %}
	{{upload.filename}}
	|
	{{ parent() }}
{% endblock %}
{% block body %}
	{% set lastZone = null %}
	{% set lastProductLine = null %}
	{% set lastCategory = null %}
	{% set lastButton = null %}

	<script>
		{% if zone is defined and zone is not null %}
zoneIdFromServer = parseInt('{{ zone.getId() }}');{% endif %}{% if productLine is defined and productLine is not null %}productLineIdFromServer = parseInt('{{ productLine.getId() }}');{% endif %}{% if category is defined and category is not null %}categoryIdFromServer = parseInt('{{ category.getId() }}');{% endif %}{% if button is defined and button is not null %}buttonIdFromServer = parseInt('{{ button.getId() }}');{% endif %}
	</script>


	<div class="card border-0 shadow rounded-3 my-5 bg-secondary">
		<div class="card-body ">
			<div class="row d-flex align-items-center gy-lg-0 gy-5">
				<p class="text-white m-0">
					<h3 style="color:white">
						Modification du fichier
						<strong>{{upload.filename}}</strong>
						:
					</h3>
				</p>
				{{ form_start(form, {'attr': {'class': 'form-floating justify-content-center', 'id': 'modifyForm','method' : 'POST', 'enctype': 'multipart/form-data'}, 'action': path('app_modify_file', {'uploadId': upload.id})}) }}
				<div class="fallback">

					{% if upload.validated is same as(null)%}
						<div class=" alert alert-danger m-0 justify-content-center">
							<h5>
								<strong>
									Fichier non validé.
								</strong>
							</h5>
						</div>
						<iframe src="{{ path('app_download_invalidation_file', { 'uploadId': upload.id }) }}" width="100%" height="750" target="_blank"></iframe>
					{% elseif upload.validated is same as(false) %}
						<div class=" alert alert-danger m-0 justify-content-center">
							<h5>
								<strong>
									Fichier refusé.
								</strong>
							</h5>
						</div>
						<iframe src="{{ path('app_download_invalidation_file', { 'uploadId': upload.id }) }}" width="100%" height="750" target="_blank"></iframe>

					{% else %}
						<iframe src="{{ path('app_download_file', { 'uploadId': upload.id }) }}" width="100%" height="750" target="_blank"></iframe>
					{% endif %}
					<div class="mb-3 mt-3">
						{{ form_label(form.file, 'Choisissez un ficher à ajouter :', {'label_attr': {'class': 'form-label', 'style': 'color:white'}}) }}
						{{ form_widget(form.file, {'attr': {'class': 'form-control', 'id': 'file', 'accept' : '.pdf'}}) }}
					</div>

					<div class="mb-3">
						{{ form_label(form.filename, 'Nouveau nom du fichier :', {'label_attr': {'class': 'form-label', 'style': 'color:white'}}) }}
						{{ form_widget(form.filename, {'attr': {'class': 'form-control', 'id': 'filename', 'placeholder': 'Entrer un nouveau nom de fichier (optionnel)'}}) }}
					</div>

					{# Display the current button hierarchy #}
					{% if lastZone != upload.button.category.productLine.zone %}
						{% set lastZone = upload.button.category.productLine.zone %}
						Zone:
						{{ lastZone.name|split('.')|first|upper }}
						>
					{% endif %}
					{% if lastProductLine != upload.button.category.productLine %}
						{% set lastProductLine = upload.button.category.productLine %}
						Produit:
						{{ lastProductLine.name|split('.')|first|upper }}
						>
					{% endif %}
					{% if lastCategory != upload.button.category %}
						{% set lastCategory = upload.button.category %}
						Categorie:
						{{ lastCategory.name|split('.')|first|upper }}
						>
					{% endif %}

					{% if lastButton != upload.button %}
						{% set lastButton = upload.button %}
						Bouton:
						{{ lastButton.name|split('.')|first|upper }}
						:
					{% endif %}

					<div class="row">
						<div class="col-md-2 col-sm-2 mt-2 mb-2">
							<label for="zone" style="color:white">Zone :</label>
						</div>
						<div class="col-md-10 col-sm-10 mt-2 mb-2">
							<select name="zone" id="zone" class="form-select" required>
								<option value="" selected disabled hidden>Choisir une Zone</option>
							</select>
						</div>
						<div class="col-md-2 col-sm-2 mt-2 mb-2">
							<label for="productline" style="color:white">Ligne :</label>
						</div>
						<div class="col-md-10 col-sm-10 mt-2 mb-2">
							<select name="productline" id="productline" class="form-select" required>
								<option value="" selected disabled hidden>Choisir une Ligne</option>
							</select>
						</div>
						<div class="col-md-2 col-sm-2 mt-2 mb-2">
							<label for="category" style="color:white">Categorie :</label>
						</div>
						<div class="col-md-10 col-sm-10 mt-2 mb-2">
							<select name="category" id="category" class="form-select" required>
								<option value="" selected disabled hidden>Choisir une Catégorie</option>
							</select>
						</div>
						<div class="col-md-2 col-sm-2 mt-2 mb-2">
							<label for="button" style="color:white">Bouton :</label>
						</div>


						<div class="col-md-10 col-sm-10 mt-2 mb-2">
							{{ form_widget(form.button,{'attr': {'class': 'form-select', 'name': 'button', 'id': 'upload_button', 'required': true}}) }}
						</div>
					</div>
				</div>

				<div class="d-grid gap-2 d-md-flex justify-content-md-center mt-5">
					<button type="submit" class="btn btn-primary mb-5">Modifier</button>
				</div>
				{{ form_end(form) }}

			</div>
		</div>
	</div>
{% endblock %}
